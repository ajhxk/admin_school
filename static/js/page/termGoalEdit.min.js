$(function () {

    navActiveSet('course_set');

    //检查名字是否重复
    $('#termName').blur(function () {
        var termname = $('#termName').val();
        var groupId = $('#groupId').val();
        $.ajax({
            url: '/semester/verifyName',
            data: {'name': termname,'groupId':groupId},
            type: "POST",
            success: function (data) {
                if (data.type == 500) {
                    $('#errorSign_termName').text(data.msg);
                } else {
                    $('#errorSign_termName').text('');
                }
            },
            error: function () {
                lock.reset();
            }
        });
    });

    //字段规则检查
    function checkParams() {

        var termname = $('#termName').val();
        if (!verification.empty(termname)) {
            $('.errorSign').text('');
            $('#errorSign_termName').text('请输入学期名称');
            return false;
        }
        if (!verification.max(termname, 20)) {
            $('.errorSign').text('');
            $('#errorSign_termName').text('请输入20字以内的学期名称');
            return false;
        }

        var termstarttime = $('#termStartTime').val();
        if (!verification.empty(termstarttime)) {
            $('.errorSign').text('');
            $('#errorSign_termTime').text('请输入正确的学期开始和结束时间');
            return false;
        }

        var termendtime = $('#termEndTime').val();
        if (!verification.empty(termendtime)) {
            $('.errorSign').text('');
            $('#errorSign_termTime').text('请输入正确的学期开始和结束时间');
            return false;
        }

        if (!verification.compare(termstarttime, termendtime)) {
            $('.errorSign').text('');
            $('#errorSign_termTime').text('请输入正确的学期开始和结束时间');
            return false;
        }


        var termtargetboy = $('#termTargetBoy').val();
        if (!verification.empty(termtargetboy)) {
            $('.errorSign').text('');
            $('#errorSign_termTargetBoy').text('请输入目标公里数');
            return false;
        }

        var daytargetboy = $('#dayTargetBoy').val();
        if (!verification.empty(daytargetboy)) {
            $('.errorSign').text('');
            $('#errorSign_dayTargetBoy').text('请输入每日目标');
            return false
        }

        var termtargetgirl = $('#termTargetGirl').val();
        if (!verification.empty(termtargetgirl)) {
            $('.errorSign').text('');
            $('#errorSign_termTargetGirl').text('请输入目标公里数');
            return false;
        }

        var daytargetgirl = $('#dayTargetGirl').val();
        if (!verification.empty(daytargetgirl)) {
            $('.errorSign').text('');
            $('#errorSign_dayTargetGirl').text('请输入每日目标');
            return false;
        }

   /*     var unids = $('#unids').val();
        if (!verification.empty(unids)) {
            $('.errorSign').text('');
            $('#errorSign_campusSelect').text('请选择应用校区');
            return false;
        }*/




        /*========================
            学期目标合理性校验
         ========================*/

        var dateStartTime = new Date(termstarttime.replace(/-/g,"/")),
            dateEndTime = new Date(termendtime.replace(/-/g,"/"));

        var timeNum = dateEndTime.getTime() - dateStartTime.getTime(),
            days = parseInt( timeNum/(1000*60*60*24) );

        var termtargetboy = Number(termtargetboy),
            termtargetgirl = Number(termtargetgirl);

        //男生 学期目标设定合理性检查
        if(termtargetboy > days*Number(daytargetboy)){
            window.Confirm('保存失败::none','学生无法完成学期目标，请设置合理的学期时间和目标','' );
            return false;
        }

        //女生 学期目标设定合理性检查
        if(termtargetgirl > days*Number(daytargetgirl)){
            window.Confirm('保存失败::none','学生无法完成学期目标，请设置合理的学期时间和目标','' );
            return false;
        }



        return true;
    }


    $('#termGoalSave').click(function () {

        var campusSelected = $(".campusSelect:checked"),
            campus_len = campusSelected.length,
            unids = '';

        for (var i = 0; i < campus_len; i++) {
            if (i == 0) {
                unids += campusSelected.eq(0).val();
            } else {
                unids += ',' + campusSelected.eq(i).val();
            }
        }
        $('#unids').attr('value', unids);

        if (!checkParams()) {
            return false;
        }

        if (!lock.lock()) {
            return false;
        }

        //字段错误提示清除
        $('.errorSign').text('');

/*        $('#termGoalSave_form').ajaxSubmit({

            url: '/semester/editForm',
            cache: false,
            dataType: 'json',
            type: 'POST',
            success: function (data) {
                if (data.type == 200) {
                    window.location.href = '/semester/list';
                } else {

                    lock.reset();
                    alert(data.msg);
                }
            },
            error: function () {
                lock.reset();
            }
        });*/

    });


    $('#termGoalCancel').click(function () {
        window.history.go(-1);
    });

});