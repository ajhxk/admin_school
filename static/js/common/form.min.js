/**
 * Created by yanyanwang on 15/12/29.
 */



$(function () {

    $(document).on('click', '.item_ioc_opened', function () {
        $(this).removeClass("item_ioc_opened");
        $(this).addClass("item_ioc_closed");
        $(this).parent().next().slideUp()
    });


    $(document).on('click', '.item_ioc_closed', function () {
        $(this).removeClass("item_ioc_closed");
        $(this).addClass("item_ioc_opened");
        $(this).parent().next().slideDown()
    });

    $(".form").css("height", document.body.scrollHeight);

    $(".form_box").css("height", document.body.scrollHeight - 90);

    $(document).on('keyup',"input[number='1']",function(){
        this.value = this.value.replace(/\D/g, '');
    });

    $(document).on('keyup',"input[price='1']",function(){
        var reg = this.value.match(/\d+\.?\d{0,1}/);
        var txt = '';
        if (reg != null) {
            txt = reg[0];
        }
        this.value = txt;
    });

});

var errorTip = {
    show: function (msg) {
        $(".error_area").html(msg).css('color', 'red');
    },

    reset: function () {
        $(".error_area").html("错误提示区域").css('color', '#ccc');
    }

};

/**
 *
 * 处理重复提交的锁
 */
var lock = {
    lock: function () {
        if (window.locked == 1) {
            return false;
        }
        window.locked = 1;
        return true;
    },
    reset: function () {
        window.locked = 0;
    }
};

function validatePrice(id) {
    var reg = $("#" + id).val().match(/\d+\.?\d{0,1}/);
    var txt = '';
    if (reg != null) {
        txt = reg[0];
    }
    $("#" + id).val(txt);
}


function validatePriceByObj(obj) {
    var reg = $(obj).val().match(/\d+\.?\d{0,1}/);
    var txt = '';
    if (reg != null) {
        txt = reg[0];
    }
    $(obj).val(txt);
}

function numberReplace(obj) {
    obj.value = obj.value.replace(/\D/g, '');
}

function checkForm() {
    var bool = true;
    $("input[type=text]").each(function () {
        var val = $(this).val();
        if (!verification.empty(val) && $(this).attr("m") == "required") {
            var name = getName($(this).prev().text());
            errorTip.show(name + "不能为空!");
            //$(this).addClass("tip_info");
            bool = false;
            return false;
        }
        var v = $(this).attr("v");
        if (v != undefined) {
            if (v == "phone" && !verification.checkPhone(val)) {
                errorTip.show("请检查手机号码是否正确!");
                bool = false;
                return false;
            } else if (v == "countryNum" && !verification.countryNum(val)) {
                errorTip.show("请检查区号是否正确!");
                bool = false;
                return false;
            } else if (v == "tel" && !verification.tel(val)) {
                errorTip.show("请检查电话号码是否正确!");
                bool = false;
                return false;
            } else if (v == "mail" && !verification.email(val)) {
                errorTip.show("请检查邮箱是否正确!");
                bool = false;
                return false;
            } else if (v == "integer" && !verification.positiveInteger(val)) {
                errorTip.show("请输入数字!");
                bool = false;
                return false;
            } else if (v == "price" && !verification.price(val)) {
                errorTip.show("请输入正确的价格!");
                bool = false;
                return false;
            }
        }
    })
    if (bool) {
        $(".common_select_type").each(function () {
            if ($(this).attr("m") != undefined) {
                var name = getName($(this).parent().parent().parent().parent().find(".form_label").text());
                if ($(this).attr("m") == "required") {
                    var op = $(this).data().option;
                    if (op == "") {
                        errorTip.show("请选择" + name + "!");
                        bool = false;
                        return false;
                    }
                }
            }
        })
    }
    if (bool) {
        errorTip.show("");
        return true;
    }
}

function getName(name) {
    if (name != undefined) {
        name = name.replace(":", "");
        name = name.replace(" ", "");
        name = name.replace(/\ +/g, "");
    }
    return name;
}

function onHref(url) {
    location.href = url;
    return true;
};